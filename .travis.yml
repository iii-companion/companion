dist: trusty
sudo: required

before_install:
  - sudo apt-get -qq update

install:
  - sudo apt-get install --yes --force-yes circos build-essential wget fasttree hmmer lua5.1 blast2 ncbi-blast+ unzip cpanminus mummer python-setuptools exonerate snap infernal mafft netcat libboost-iostreams-dev libgsl0ldbl libcolamd2.8.0 libstdc++6
  - sudo apt-get install --yes curl software-properties-common gcc-snapshot
  - sudo add-apt-repository --yes ppa:openjdk-r/ppa
  - sudo add-apt-repository --yes ppa:jochenkemnade/openjdk-8
  - sudo apt-get update -qq
  - sudo apt-get install --yes openjdk-8-jre
  - sudo (update-java-alternatives --set java-1.8.0-openjdk-amd64 2&>/dev/null; exit 0) # sorry :-/
  - sudo ln -s /usr/bin/fasttree /usr/bin/FastTree
  - sudo test/travis.setup-augustus.sh > /dev/null 
  - sudo test/travis.setup-gt.sh > /dev/null 
  - sudo test/travis.setup-last.sh > /dev/null 
  - sudo test/travis.setup-orthomcl.sh > /dev/null
  - sudo test/travis.setup-aragorn.sh > /dev/null
  - sudo test/travis.setup-gff3toembl.sh > /dev/null
  - sudo cpanm -q --force Carp Storable Bio::SearchIO List::Util Getopt::Long
  - curl -fsSL get.nextflow.io | bash
  - wget -q http://geneontology.org/ontology/go.obo
  - travis_wait wget -q http://ftp.ebi.ac.uk/pub/databases/Pfam/current_release/Pfam-A.hmm.gz
  - zcat Pfam-A.hmm.gz | test/split-hmm.lua 1000 > Pfam-A.hmm
  - travis_wait hmmpress Pfam-A.hmm
  - rm -f Pfam-A.hmm

cache:
  directories:
    - work
env:
  global:
    - ROOTDIR="$TRAVIS_BUILD_DIR"
script:
  - cd test/testsuite
  - ./testsuite.rb -threads 2
  - cd ../..
  - travis_wait ./nextflow -c loc_travis.config -c params_default.config run annot.nf --do_circos=false
  - travis_wait ./nextflow -c loc_travis.config -c params_default.config run annot.nf --do_circos=false --run_exonerate=true
  - travis_wait ./nextflow -c loc_travis.config -c params_default.config run annot.nf --do_circos=false --do_pseudo=false
  - travis_wait ./nextflow -c loc_travis.config -c params_default.config run annot.nf --do_circos=false --run_snap=false
